javascript:(function()%7Bvar%20allProducts%20%3D%20%5B%5D%3BaddInterface()%3Bvar%20completed%20%3D%200%3Bvar%20currentPage%20%3D%201%3BgetAllProducts()%3Bfunction%20getAllProducts()%20%7Bvar%20p%3Bp%20%3D%20getProductsForPage()%3Bfor%20(var%20i%20in%20p)%20%7BallProducts.push(p%5Bi%5D)%3B%7Dvar%20num%20%3D%20getNumPages()%3Bfor%20(var%20i%20%3D%201%3Bi%20%3C%3D%20num%3Bi%2B%2B)%20%7BsetTimeout(function()%20%7BgetNextPage()%3Bvar%20p%20%3D%20getProductsForPage()%3Bfor%20(i%20in%20p)%20%7BallProducts.push(p%5Bi%5D)%3B%7Dconsole.log(allProducts)%3B%7D%2C%202E3%20*%20i)%3B%7DsetTimeout(function()%20%7BsetStatus(%22Getting%20card%20conditions%20(%22%20%2B%20allProducts.length%20%2B%20%22)%2C%20this%20may%20take%20up%20to%20%22%20%2B%20allProducts.length%20%2F%2060%20%2B%20%22%20minutes%22)%3B%7D%2C%202E3%20*%20num%20%2B%20.5)%3BsetTimeout(function()%20%7Bvar%20promise%20%3D%20getConditions(allProducts)%3B%24.when(promise).done(function()%7BexportFile()%3B%7D)%3B%7D%2C%202E3%20*%20num%20%2B%201)%3B%7Dfunction%20getProductsForPage()%20%7Bvar%20products%20%3D%20%5B%5D%3B%24(%22%23ProductsTable%20tr%22).each(function()%20%7Bvar%20row%20%3D%20%5B%5D%3Bvar%20id%20%3D%20%22%22%3B%24(this).find(%22td%22).each(function()%20%7Brow.push(%24(this).html())%3Bif%20(%24(this).attr(%22id%22))%20%7Bid%20%3D%20%24(this).attr(%22id%22)%3Bid%20%3D%20id.replace(%2F%5E.*_%2F%2C%20%22%22)%3B%7D%7D)%3Bvar%20values%20%3D%20%5B%5D%3Bvalues%5B%22type%22%5D%20%3D%20striptags(row%5B0%5D)%3Bvalues%5B%22name%22%5D%20%3D%20striptags(row%5B1%5D)%3Bvalues%5B%22id%22%5D%20%3D%20id%3Bvalues%5B%22set%22%5D%20%3D%20striptags(row%5B2%5D)%3Bvalues%5B%22rarity%22%5D%20%3D%20striptags(row%5B3%5D)%3Bvalues%5B%22number%22%5D%20%3D%20striptags(row%5B4%5D)%3Bvalues%5B%22link%22%5D%20%3D%20striptags(row%5B6%5D)%3Bif%20(!id%20%3D%3D%20%22%22)%20%7Bproducts%5Bvalues%5B%22id%22%5D%5D%20%3D%20values%3B%7D%7D)%3Breturn%20products%3B%7Dfunction%20getNextPage()%20%7BsetStatus(%22Getting%20Page%20%22%20%2B%20currentPage%20%2B%20%22%20(%22%20%2B%20allProducts.length%20%2B%20%22%20total%20products)%22)%3Bvar%20nextLink%3B%24(%22.pager%20a%22).each(function()%20%7Bif%20(%24(this).html()%20%3D%3D%20%22Next%22)%20%7BnextLink%20%3D%20%24(this)%3B%7D%7D)%3Bif%20(!nextLink.hasClass(%22ui-state-disabled%22))%20%7BnextLink.click()%3BcurrentPage%2B%2B%3Breturn%20true%3B%7D%20else%20%7Breturn%20false%3B%7D%7Dfunction%20getNumPages()%20%7Breturn%20%24(%22.pager%20a%3Anot(.ui-state-disabled)%22).length%20-%201%3B%7Dfunction%20striptags(OriginalString)%20%7BOriginalString%20%3D%20OriginalString%20%3D%3D%3D%20undefined%20%3F%20%22%22%20%3A%20OriginalString%3Bvar%20StrippedString%20%3D%20OriginalString.replace(%2F(%3C(%5B%5E%3E%5D%2B)%3E)%2Fig%2C%20%22%22)%3Bvar%20ret%20%3D%20StrippedString.replace(%2F%5B%5E-0-9a-zA-Z'%5D%2Fig%2C%20%22%22)%3Breturn%20ret%3B%7Dfunction%20getConditions(allProducts)%20%7Bconsole.log(%22getting%20conditions%22)%3Bvar%20def%20%3D%20%24.Deferred()%3Bvar%20getArray%20%3D%20%5B%5D%3Bfor%20(var%20i%20%3D%200%3Bi%20%3C%20allProducts.length%20%3Bi%2B%2B)%20%7BgetArray.push(getCondition(allProducts%5Bi%5D%2C%20i))%3B%7D%24.when.apply(%24%2C%20getArray).then(function()%20%7B%20def.resolve()%3B%20%7D)%3Breturn%20def.promise()%3B%7Dfunction%20getCondition(product%2C%20i)%20%7Bvar%20def%20%3D%20%24.Deferred()%3Bvar%20promise%20%3D%20%24.ajax(%7Burl%3A%22https%3A%2F%2Fstore.tcgplayer.com%2Fadmin%2Fproduct%2Fmanage%2F%22%20%2B%20product%5B%22id%22%5D%20%2B%20%22%3FOnlyMyInventory%3Dtrue%22%2C%20async%3Atrue%7D).success(function(data)%20%7Bcompleted%2B%2B%3BupdateProgress()%3Bvar%20table%20%3D%20%24(data).find(%22.display.sTable%20tbody%22)%3Bvar%20stock%20%3D%20%5B%5D%3B%24(table).find(%22tr%22).each(function()%20%7Bvar%20thisRow%20%3D%20%5B%5D%3BthisRow%5B%22condition%22%5D%20%3D%20striptags(%24(this).find(%22td%3Afirst-child%22).html())%3BthisRow%5B%22quantity%22%5D%20%3D%20%24(this).find(%22td%3Anth-child(5n)%20input%22).val()%3BthisRow%5B%22price%22%5D%20%3D%20%24(this).find(%22td%3Anth-child(6n)%20input%22).val()%3Bif%20(thisRow%5B%22quantity%22%5D%20%3E%200)%20%7Bstock%5Bproduct%5B%22id%22%5D%20%2B%20%22_%22%20%2B%20thisRow%5B%22condition%22%5D%5D%20%3D%20thisRow%3B%7D%7D)%3BallProducts%5Bi%5D%5B%22stock%22%5D%20%3D%20stock%3B%7D)%3B%24.when(promise).done(function()%20%7Bdef.resolve()%3B%7D)%3Breturn%20def.promise()%3B%7Dfunction%20exportFile()%20%7Bconsole.log(%22exporting%22)%3Bvar%20list%20%3D%20%5B%5D%3Bfor%20(var%20i%20%3D%200%3Bi%20%3C%20allProducts.length%3Bi%2B%2B)%20%7Bfor%20(s%20in%20allProducts%5Bi%5D%5B%22stock%22%5D)%20%7Bconsole.log(%22pushing%20stock%22)%3Bvar%20thisRet%20%3D%20%5BallProducts%5Bi%5D%5B%22id%22%5D%2C%20allProducts%5Bi%5D%5B%22name%22%5D%2C%20allProducts%5Bi%5D%5B%22set%22%5D%2C%20allProducts%5Bi%5D%5B%22stock%22%5D%5Bs%5D%5B%22condition%22%5D%2C%20allProducts%5Bi%5D%5B%22stock%22%5D%5Bs%5D%5B%22price%22%5D%2C%20allProducts%5Bi%5D%5B%22stock%22%5D%5Bs%5D%5B%22quantity%22%5D%5D%3Blist.push(thisRet)%3Bconsole.log(thisRet)%3B%7D%7Dvar%20csvContent%20%3D%20%22data%3Atext%2Fcsv%3Bcharset%3Dutf-8%2C%22%3Blist.forEach(function(infoArray%2C%20index)%20%7BdataString%20%3D%20infoArray.join(%22%2C%22)%3BcsvContent%20%2B%3D%20index%20%3C%20list.length%20%3F%20dataString%20%2B%20%22%5Cn%22%20%3A%20dataString%3B%7D)%3BsetStatus(%22%22)%3Bvar%20encodedUri%20%3D%20encodeURI(csvContent)%3Bvar%20link%20%3D%20document.createElement(%22a%22)%3Blink.setAttribute(%22href%22%2C%20encodedUri)%3Blink.setAttribute(%22id%22%2C%20%22downloadLink%22)%3Bvar%20linkText%20%3D%20document.createTextNode(%22Download%20Inventory%22)%3Blink.appendChild(linkText)%3Blink.setAttribute(%22download%22%2C%20getFileName())%3B%24('%23exportWrap%20%23status').append(link)%3B%24('%23downloadLink').css(%7Bpadding%3A%20'2px%2010px%208px%2010px'%2Cheight%3A%20'15px'%2Cdisplay%3A%20'inline-block'%2Cborder%3A%20'1px%20solid%20%23447fac'%2C'border-radius'%3A%20'3px'%2Ccursor%3A%20'pointer'%2Cbackground%3A%20'%2372b8e4%20url(..%2FContent%2Fimages%2Fbackgrounds%2FtitleBgBlue.jpg)%20repeat-x'%2Ccolor%3A%20'%23fff'%2Cmargin%3A%20'1em%20auto'%7D)%3B%7Dfunction%20getFileName()%20%7Bvar%20today%20%3D%20new%20Date%3Bvar%20dd%20%3D%20today.getDate()%3Bvar%20mm%20%3D%20today.getMonth()%20%2B%201%3Bvar%20yyyy%20%3D%20today.getFullYear()%3Bif%20(dd%20%3C%2010)%20%7Bdd%20%3D%20%220%22%20%2B%20dd%3B%7Dif%20(mm%20%3C%2010)%20%7Bmm%20%3D%20%220%22%20%2B%20mm%3B%7Dvar%20today%20%3D%20dd%20%2B%20%22_%22%20%2B%20mm%20%2B%20%22_%22%20%2B%20yyyy%20%2B%20%22_tcg_inventory.csv%22%3Breturn%20today%3B%7Dfunction%20addInterface()%20%7Bvar%20barHtml%20%3D%20'%3Cdiv%20id%3D%22exportWrap%22%3E%3Cp%20style%3D%22text-align%3A%20center%3B%20margin-bottom%3A1em%3B%22%3EExporting%20Inventory%2C%20please%20wait%3A%20%3Cb%3EDO%20NOTHING!%3C%2Fb%3E%3C%2Fp%3E%3Cdiv%20id%3D%22progress%22%3E%3Cdiv%20class%3D%22bar%22%3E%3Cdiv%20class%3D%22caption%22%20style%3D%22text-align%3A%20center%3B%20position%3A%20absolute%3B%20left%3A%200px%3B%20right%3A%200px%3B%20text-shadow%3A%201px%201px%20%23fff%3Bline-height%3A%202em%3B%20top%3A%200px%3B%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3Cp%20style%3D%22text-align%3A%20center%3B%22%20id%3D%22status%22%3E%3C%2Fp%3E%3Cdiv%20style%3D%22float%3A%20right%3B%20color%3A%20%23666%3Bpadding-top%3A%201em%3B%22%3ECompliments%20of%20%3Ca%20href%3D%22http%3A%2F%2Furza.com%3Fref%3Dtcg_extractor%22%3EUrza.com%3C%2Fa%3E%3C%2Fdiv%3E%3C%2Fdiv%3E'%3B%24(%22body%20%3E%20*%3Afirst-child%22).before(barHtml)%3B%24(%22%23exportWrap%22).css(%22padding%22%2C%20%221em%22)%3B%24(%22%23exportWrap%22).css(%22margin%22%2C%20%221em%22)%3B%24(%22%23exportWrap%22).css(%22background-color%22%2C%20%22%23ccc%22)%3B%24(%22%23exportWrap%22).css(%22text-align%22%2C%20%22center%22)%3B%24(%22%23progress%22).css('background-color'%2C'%23fff')%3B%24(%22%23progress%22).css('position'%2C'relative')%3B%24(%22%23progress%22).css('padding'%2C'.5em')%3B%24(%22%23progress%20.bar%22).css('width'%2C'0%25')%3B%24(%22%23progress%20.bar%22).css('background-color'%2C'%2372b8e4')%3B%24(%22%23progress%20.bar%22).css('height'%2C'1em')%3B%7Dfunction%20setStatus(str)%20%7B%24(%22%23status%22).html(str)%3B%7Dfunction%20updateProgress()%7Bconsole.log('Progress%3A'%20%2B%20completed%2FallProducts.length*100%20%2B%20'%25')%3B%24('%23progress%20.caption').html(completed%20%2B%20%22%2F%22%20%2B%20allProducts.length)%3B%24('%23progress%20.bar').css('width'%2Ccompleted%2FallProducts.length*100%2B%22%25%22)%3B%7D%7D)()
